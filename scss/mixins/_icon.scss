@use 'sass:list';
@use 'sass:meta';
@use '../variables';

////
/// Applies an SVG icon to an element as a background image or mask.
///
/// This mixin adds the specified SVG icon as a background image, with optional mask support for modern browsers.
/// For legacy support, a fallback background image is applied.
///
/// **Browser Support:**
/// - `mask` is supported in modern browsers (Chrome, Edge, Safari).
/// - Fallback `background` ensures compatibility with legacy browsers.
///
/// **Parameters:**
/// - `$icon`: The name of the SVG icon (string). Required.
/// - `$size`: The size of the icon (single value or list, e.g., `24px` or `24px 24px`). Defaults to `24px 24px`.
/// - `$backgroundPosition`: The position of the background image. Defaults to `center center`.
/// - `$mask`: Whether to apply a mask (boolean). Defaults to `true`.
/// - `$color`: The color of the icon when using a mask. Defaults to `currentColor`.
///
/// @example
/// ```scss
/// .icon {
///   @include icon('arrow-left', 32px, center center, true, red);
/// }
/// ```
////
@mixin icon($icon, $size: 24px 24px, $backgroundPosition: center center, $mask: true, $color: currentColor) {
  // Validate $icon
  @if meta.type-of($icon) != 'string' {
    @error "@valantic-scss-utils -- 'icon()': $icon must be a string. Received: #{meta.type-of($icon)}.";
  }

  // Ensure $size is always a dual value
  $calculatedSize: if(meta.type-of($size) == 'number', $size $size, $size);

  // Legacy support. No color applied.
  background: url('#{variables.$va-icon-base-path}##{$icon}') no-repeat $backgroundPosition / $calculatedSize;

  @if $mask == true {
    @supports (mask: no-repeat) {
      background: $color;
      mask: url('#{variables.$va-icon-base-path}##{$icon}') no-repeat $backgroundPosition / $calculatedSize;
    }
  }
}
