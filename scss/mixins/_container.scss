@use 'sass:map';
@use 'sass:meta';
@use 'sass:list';
@use '../variables';
@use '../lib';

/// Creates a container query based on parent dimensions.
///
/// Supports both named breakpoints from `$breakpoints` (e.g., `xs`, `sm`) and absolute values (e.g., `768px`).
/// By default, queries are based on width but can be customized to query other dimensions (e.g., height).
///
/// @param {string|number|null} [$up=null] Minimum size for the container query (e.g., `sm` or `768px`).
/// @param {string|number|null} [$down=null] Maximum size for the container query (e.g., `lg` or `1024px`).
/// @param {map} [$breakpoints=variables.$va-breakpoints] A map of named breakpoints (e.g., `sm: 768px`).
/// @param {string} [$dimension=width] The container dimension to query (e.g., `width`, `height`). Defaults to `width`.
///
/// @throws An error if `$up` or `$down` are invalid values, or `$up` > `$down`.
///
/// @example
/// ```scss
/// .container {
///   @include container(sm, lg) {
///     background: red;
///   }
///
///   @include container(400px, 800px) {
///     background: blue;
///   }
///
///   @include container(300px, null, variables.$va-breakpoints, height) {
///     background: green;
///   }
/// }
/// ```
@mixin container($up: null, $down: null, $breakpoints: variables.$va-breakpoints, $dimension: width) {
  // Pre-compute query values
  $upValue: if (meta.type-of($up) == number, $up, map.get($breakpoints, $up));
  $downValue: if (meta.type-of($down) == number, $down, map.get($breakpoints, $down));

  // Validate inputs
  @if not $up and not $down {
    @include lib.throw-error('Mixin container', "At least one of $up or $down must be defined.");
  }

  @if $up and not $upValue {
    @include lib.throw-error('Mixin container', "Invalid $up value '#{$up}'. Must be a number or a valid breakpoint key.");
  }

  @if $down and not $downValue {
    @include lib.throw-error('Mixin container', "Invalid $down value '#{$down}'. Must be a number or a valid breakpoint key.");
  }

  @if $upValue and $downValue and $upValue >= $downValue {
    @include lib.throw-error('Mixin container', "$up value '#{$upValue}' must be less than $down value '#{$downValue}'.");
  }

  // Build container query
  $query: '';
  @if $up {
    $query: $query + " (min-#{$dimension}: #{$upValue})";
  }
  @if $down {
    $query: $query + if (meta.type-of($down) == number, " (max-#{$dimension}: #{$downValue})", " (max-#{$dimension}: #{$downValue - 1px})");
  }

  // Apply container query and content
  @container #{$query} {
    @content;
  }
}
